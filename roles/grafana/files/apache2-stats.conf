<VirtualHost *:80>
	ServerName stats.freifunk-vogtland.net
	ServerAdmin info@freifunk-vogtland.net
	DocumentRoot /var/www/html

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	RewriteEngine  on
	RewriteRule "^/dashboard/file/global\.json(.*)$" "/d/Zy8gTRgik/global$1" [PT]
	RewriteRule "^/api/dashboards/db/global.json(.*)$" "/api/dashboards/db/global$1" [PT]
	RewriteRule "^/render/dashboard-solo/file/global\.json(.*)$" "/render/d-solo/Zy8gTRgik/global$1" [PT]

	RewriteRule "^/dashboard/file/nodethumbnails\.json(.*)$" "/d/wQ8goRRmz/nodethumbnails$1" [PT]
	RewriteRule "^/api/dashboards/db/nodethumbnails.json(.*)$" "/api/dashboards/db/nodethumbnails$1" [PT]
	RewriteRule "^/render/dashboard-solo/file/nodethumbnails\.json(.*)$" "/render/d-solo/wQ8goRRmz/nodethumbnails$1" [PT]

	RewriteRule "^/dashboard/file/node\.json(.*)$" "/d/NjUgoRgmz/node$1" [PT]
	RewriteRule "^/api/dashboards/db/node.json(.*)$" "/api/dashboards/db/node$1" [PT]
	RewriteRule "^/render/dashboard-solo/file/node\.json(.*)$" "/render/d-solo/NjUgoRgmz/node$1" [PT]

	ProxyPreserveHost On
	ProxyPass /.well-known/acme-challenge/ !
	ProxyPass / http://0.0.0.0:3000/
	ProxyPassReverse / http://0.0.0.0:3000/

	Header set Access-Control-Allow-Origin "*"
</VirtualHost>

<VirtualHost *:443>
	ServerName stats.freifunk-vogtland.net
	ServerAdmin info@freifunk-vogtland.net
	DocumentRoot /var/www/html

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on
        SSLCertificateFile    /etc/letsencrypt/live/stats.freifunk-vogtland.net/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/stats.freifunk-vogtland.net/privkey.pem
        SSLCACertificateFile /etc/ssl/certs/ca-certificates.crt

        Include /etc/letsencrypt/options-ssl.conf
        Header always set Strict-Transport-Security "max-age=15768000; includeSubDomains; preload"

	RewriteEngine  on
	RewriteRule "^/dashboard/file/global\.json(.*)$" "/d/Zy8gTRgik/global$1" [PT]
	RewriteRule "^/api/dashboards/db/global.json(.*)$" "/api/dashboards/db/global$1" [PT]
	RewriteRule "^/render/dashboard-solo/file/global\.json(.*)$" "/render/d-solo/Zy8gTRgik/global$1" [PT]

	RewriteRule "^/dashboard/file/nodethumbnails\.json(.*)$" "/d/wQ8goRRmz/nodethumbnails$1" [PT]
	RewriteRule "^/api/dashboards/db/nodethumbnails.json(.*)$" "/api/dashboards/db/nodethumbnails$1" [PT]
	RewriteRule "^/render/dashboard-solo/file/nodethumbnails\.json(.*)$" "/render/d-solo/wQ8goRRmz/nodethumbnails$1" [PT]

	RewriteRule "^/dashboard/file/node\.json(.*)$" "/d/NjUgoRgmz/node$1" [PT]
	RewriteRule "^/api/dashboards/db/node.json(.*)$" "/api/dashboards/db/node$1" [PT]
	RewriteRule "^/render/dashboard-solo/file/node\.json(.*)$" "/render/d-solo/NjUgoRgmz/node$1" [PT]

	ProxyPreserveHost On
	ProxyPass /.well-known/acme-challenge/ !
	ProxyPass / http://0.0.0.0:3000/
	ProxyPassReverse / http://0.0.0.0:3000/

	Header set Access-Control-Allow-Origin "*"
</VirtualHost>
